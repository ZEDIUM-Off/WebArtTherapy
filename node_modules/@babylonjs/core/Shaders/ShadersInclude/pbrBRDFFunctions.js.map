{"version":3,"file":"pbrBRDFFunctions.js","sourceRoot":"","sources":["../../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts"],"names":[],"mappings":"AAAA,eAAe;AACf,OAAO,EAAE,WAAW,EAAE,MAAM,2BAA2B,CAAC;AAExD,IAAM,IAAI,GAAG,kBAAkB,CAAC;AAChC,IAAM,MAAM,GAAG,mrNAsMd,CAAC;AACF,aAAa;AACb,WAAW,CAAC,oBAAoB,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC;AAChD,cAAc;AACd,MAAM,CAAC,IAAM,gBAAgB,GAAG,EAAE,IAAI,MAAA,EAAE,MAAM,QAAA,EAAE,CAAC","sourcesContent":["// Do not edit.\nimport { ShaderStore } from \"../../Engines/shaderStore\";\n\nconst name = \"pbrBRDFFunctions\";\nconst shader = `#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\rreturn 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);\r}\r#endif\n#ifdef ENVIRONMENTBRDF\nvec3 getBRDFLookup(float NdotV,float perceptualRoughness) {\rvec2 UV=vec2(NdotV,perceptualRoughness);\rvec4 brdfLookup=texture2D(environmentBrdfSampler,UV);\r#ifdef ENVIRONMENTBRDF_RGBD\nbrdfLookup.rgb=fromRGBD(brdfLookup.rgba);\r#endif\nreturn brdfLookup.rgb;\r}\rvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 specularEnvironmentR90,const vec3 environmentBrdf) {\r#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;\r#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;\r#endif\nreturn reflectance;\r}\rvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\r#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);\r#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\r#endif\nreturn reflectance;\r}\r#endif\n/* NOT USED\r#if defined(SHEEN) && defined(SHEEN_SOFTER)\nfloat getBRDFLookupCharlieSheen(float NdotV,float perceptualRoughness)\r{\rfloat c=1.0-NdotV;\rfloat c3=c*c*c;\rreturn 0.65584461*c3+1.0/(4.16526551+exp(-7.97291361*perceptualRoughness+6.33516894));\r}\r#endif\n*/\r#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)\nvec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\r{\rfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\rreturn reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));\r}\r#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\n/**\r* The sheen BRDF not containing F can be easily stored in the blue channel of the BRDF texture.\r* The blue channel contains DCharlie*VAshikhmin*NdotL as a lokkup table\r*/\rvec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {\rvec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;\rreturn sheenEnvironmentReflectance;\r}\r#endif\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\r{\rreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\r}\rfloat fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)\r{\rreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\r}\r#ifdef CLEARCOAT\nvec3 getR0RemappedForClearCoat(vec3 f0) {\r#ifdef CLEARCOAT_DEFAULTIOR\n#ifdef MOBILE\nreturn saturate(f0*(f0*0.526868+0.529324)-0.0482256);\r#else\nreturn saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);\r#endif\n#else\nvec3 s=sqrt(f0);\rvec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);\rreturn t*t;\r#endif\n}\r#endif\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\r{\rfloat a2=square(alphaG);\rfloat d=NdotH*NdotH*(a2-1.0)+1.0;\rreturn a2/(PI*d*d);\r}\r#ifdef SHEEN\nfloat normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)\r{\rfloat invR=1./alphaG;\rfloat cos2h=NdotH*NdotH;\rfloat sin2h=1.-cos2h;\rreturn (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);\r}\r#endif\n#ifdef ANISOTROPIC\nfloat normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {\rfloat a2=alphaTB.x*alphaTB.y;\rvec3 v=vec3(alphaTB.y*TdotH,alphaTB.x *BdotH,a2*NdotH);\rfloat v2=dot(v,v);\rfloat w2=a2/v2;\rreturn a2*w2*w2*RECIPROCAL_PI;\r}\r#endif\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {\r#ifdef MOBILE\nfloat GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);\rfloat GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);\rreturn 0.5/(GGXV+GGXL);\r#else\nfloat a2=alphaG*alphaG;\rfloat GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);\rfloat GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);\rreturn 0.5/(GGXV+GGXL);\r#endif\n}\r#else\nfloat smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)\r{\r#ifdef MOBILE\nreturn 1.0/(dot+alphaG+(1.0-alphaG)*dot ));\r#else\nfloat alphaSquared=alphaG*alphaG;\rreturn 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));\r#endif\n}\rfloat smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)\r{\rfloat visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);\rreturn visibility;\r}\r#endif\n#ifdef ANISOTROPIC\nfloat smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {\rfloat lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));\rfloat lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));\rfloat v=0.5/(lambdaV+lambdaL);\rreturn v;\r}\r#endif\n#ifdef CLEARCOAT\nfloat visibility_Kelemen(float VdotH) {\rreturn 0.25/(VdotH*VdotH); \r}\r#endif\n#ifdef SHEEN\nfloat visibility_Ashikhmin(float NdotL,float NdotV)\r{\rreturn 1./(4.*(NdotL+NdotV-NdotL*NdotV));\r}\r/* NOT USED\r#ifdef SHEEN_SOFTER\nfloat l(float x,float alphaG)\r{\rfloat oneMinusAlphaSq=(1.0-alphaG)*(1.0-alphaG);\rfloat a=mix(21.5473,25.3245,oneMinusAlphaSq);\rfloat b=mix(3.82987,3.32435,oneMinusAlphaSq);\rfloat c=mix(0.19823,0.16801,oneMinusAlphaSq);\rfloat d=mix(-1.97760,-1.27393,oneMinusAlphaSq);\rfloat e=mix(-4.32054,-4.85967,oneMinusAlphaSq);\rreturn a/(1.0+b*pow(x,c))+d*x+e;\r}\rfloat lambdaSheen(float cosTheta,float alphaG)\r{\rreturn abs(cosTheta)<0.5 ? exp(l(cosTheta,alphaG)) : exp(2.0*l(0.5,alphaG)-l(1.0-cosTheta,alphaG));\r}\rfloat visibility_CharlieSheen(float NdotL,float NdotV,float alphaG)\r{\rfloat G=1.0/(1.0+lambdaSheen(NdotV,alphaG)+lambdaSheen(NdotL,alphaG));\rreturn G/(4.0*NdotV*NdotL);\r}\r#endif\n*/\r#endif\nfloat diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {\rfloat diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));\rfloat diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));\rfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\rfloat fresnel =\r(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\r(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\rreturn fresnel/PI;\r}\r#ifdef SS_TRANSLUCENCY\nvec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {\rvec3 S=1./maxEps(diffusionDistance);\rvec3 temp=exp((-0.333333333*thickness)*S);\rreturn tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);\r}\rfloat computeWrappedDiffuseNdotL(float NdotL,float w) {\rfloat t=1.0+w;\rfloat invt2=1.0/square(t);\rreturn saturate((NdotL+w)*invt2);\r}\r#endif\n`;\n// Sideeffect\nShaderStore.IncludesShadersStore[name] = shader;\n/** @hidden */\nexport const pbrBRDFFunctions = { name, shader };\n"]}